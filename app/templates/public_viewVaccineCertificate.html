<!-- Extends the basic html template -->
{% extends "dashboard_layout.html" %}
{% set active_page ="public_viewVaccineCertificate" %}

<!-- Updates the <head> of the webpage -->
{% block head %}
	<title>View Vaccine Certificate</title>
  <link rel="stylesheet" type="text/css" href="{{ url_for('static',filename='styles/public_viewVaccineCertificate.css') }}"/>
  <script src="https://html2canvas.hertzen.com/dist/html2canvas.js"></script>
{% endblock %}

<!-- Content Header -->
{% block contentHeader %}
    <b><i class="fa fa-certificate"></i>  View Vaccine Certificate</b>
{% endblock %}

<!-- Main Content of the Page -->
{% block contentBody %}
  <div class="w3-row-padding w3-margin-bottom">
    <!-- to be removed after syncing with database -->
    <button onclick="rotate()" id="rotate">Click to see different category</button>
    <!-- Completed Vaccination -->
    <div id="completed">
      <div class="imgContainer" id="cert">
        <img id="img" src="{{url_for('static', filename='certificate.png')}}"/>
        <div class="txtCenter">
          <br><br>
          <span class="standard"><i>This is to certify that</i></span>
          <br><br>
          <span class="name" id="patientName"><b></b></span><br><br>
          <span class="standard"><i>has completed the vaccination on</i></span><br><br>
          <span class="standard" id="date"></span><br><br>
          <span class="signature"><i>naaaomi</i></span><br>
          <span class="signOff">Naomi Chan</span><br>
          <span class="signOff">Project Manager, 30T</span> 
        </div>
      </div>
      <br>
      <h3>Congratulations for completing the vaccination. You can click the button below to download your certificate.</h3>
      <button onclick="downloadimage()" class="clickbtn">Download Certificate</button>
    </div>
    <br><br><br>
    
    <!-- Incomplete Vaccination -->
    <div id="incomplete">
      <!-- Eligible for Vaccination but not taken -->
      <div id="eligibleBNT">
        <img id="displayPic" src="{{url_for('static', filename='getVaccinated.jpg')}}"/>
        <h3>Our record shows that you have not been vaccinated yet. Think about your loved ones. 
          Don't expose them to unnecessary risks. Get vaccinated now! </h3>
      </div>
      <!-- Eligible for Vaccination but not Completed -->
      <div id="eligibleBNC">
        <img id="displayPic" src="{{url_for('static', filename='getVaccinated.jpg')}}"/>
        <h3>Our record shows that you have taken your first dose. 
          But that's not the end. In fact, you're only halfway done. Get your second dose now! </h3>
      </div>
      <!-- Not Eligible for Vaccination -->
      <div id="notEligible">
        <img id="displayPic" src="{{url_for('static', filename='together.jpg')}}"/>
        <h3>Unfortunately, you are not eligible for this batch of vaccination due to various health reasons. But not to worry. 
          We assure you that we are committed to keep you well protected. Please stay tuned for further updates! </h3>
      </div>
    </div>
  </div>

  <script>
    $(document).ready(function() {
      // patient's full name
      document.getElementById("patientName").innerHTML = "Drew Bay Smith";
      // date of vaccination completion
      document.getElementById("date").innerHTML = "29 April 2021";
      // disable right click on template image
      $('img').bind('contextmenu', function(e) {
        return false;
      }); 
      // disable drag and drop template image
      document.getElementById('img').ondragstart = function() { return false; };

      // set default hide all the div
      document.getElementById("completed").style.display = "none";
      document.getElementById("eligibleBNT").style.display = "none";
      document.getElementById("eligibleBNC").style.display = "none";
      document.getElementById("notEligible").style.display = "none";
    });

    function downloadimage() {
      // elements to be included in the printing
      var container = document.getElementById("cert"); 

      html2canvas(container, { allowTaint: true, scrollY: -window.scrollY }).then(function (canvas) {
        var link = document.createElement("a");
        document.body.appendChild(link);
        link.download = "certificate.jpg";
        link.href = canvas.toDataURL();
        link.target = '_blank';
        link.click();
      });
    }
    
    // for better view of individual div purposes, remove once sync with database
    var count = 0;
    function rotate() {
      var divArr = ["completed", "eligibleBNT", "eligibleBNC", "notEligible"];
      var current = document.getElementById(divArr[count]);
      current.style.display = "block";
      count++;

      for (var i = 0; i < divArr.length; i++) {
        var makeHidden = document.getElementById(divArr[i]);
        if (current != makeHidden)
        makeHidden.style.display = "none";
        if (count == divArr.length)
          count = 0;
      }
    }
  </script>

{% endblock %}