<!-- Extends the basic html template -->
{% extends "dashboard_layout.html" %}
{% set active_page ="alert" %}

<!-- Updates the <head> of the webpage -->
{% block head %}
	<title>Alerts</title>
{% endblock %}

<!-- Content Header -->
{% block contentHeader %}
    <b><i class="fa fa-bell fa-fw"></i> Alerts</b>
{% endblock %}

<!-- Main Content of the Page -->
{% block contentBody %}
  <!-- Display Alerts -->
  <div class="w3-row-padding w3-margin-bottom">
    <table>
    {% for alert in all_alerts %}
      <tr>
        <b><i>{{ alert["sent_on"] }}</i></b>
        <p>{{ alert["message"] }}</p>
        {% if alert["is_read"] == 0 %}
          <form action="/alerts" method="post">
            <input name="alert_id" value={{ alert["id"] }} type="hidden">
            <input class="markAsRead" type="submit" value="Mark as read">
          </form>
        {% endif %}
        <hr/>
      </tr>
    {% endfor %}
    </table>
  </div>
  <script>
    window.addEventListener('load', markRead);

    function markRead() {
      var buttons = document.getElementsByClassName("markAsRead");
      //var all_alerts = {{ all_alerts | safe }}
      
      // add event listener for all buttons with class "markAsRead"
      for (i = 0; i < buttons.length; i++) {
        //for (alert in all_alerts) {
          buttons[i].addEventListener("click", function () {
            /*var sent_on = new Date(alert["sent_on"]);
            var currentDateTime = new Date();
            
            // send the alert data to the controller
            $.ajax({
              url: "/alerts",
              type: "POST",
              data: JSON.stringify({
                id: alert["id"]
                read_on: currentDateTime.toJSON()
              }),
              contentType: "application/json",
              success: function(response) {
                console.log(response);
              },
              error: function(error) {
                console.log(error);
              }
            });*/
            
            // hide the mark as read button when clicked
            this.style.display = "none";
          });   
        //}
      }
    }  
  </script>
{% endblock %}